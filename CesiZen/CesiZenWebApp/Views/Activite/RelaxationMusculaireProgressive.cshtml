@{
    ViewData["Title"] = "Relaxation Musculaire Progressive";
    var userId = ViewBag.UserId ?? 0;
    var activityId = ViewBag.ActivityId ?? 0;
}
<h1 style="text-align: center; margin-bottom: 20px;">Séance de Relaxation Musculaire Progressive</h1>

<h5 style="text-align: center; margin-bottom: 40px;">Suivez les instructions pour détendre votre corps, un muscle à la fois.</h5>

<div style="text-align: center;">
    <p id="step-text" style="font-size: 18px; line-height: 1.6;">
        Fermez les yeux et prenez une profonde inspiration. Nous allons commencer la relaxation musculaire progressive.
    </p>

    <button id="start-button" onclick="startRelaxation()" style="margin-top: 20px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
        Commencer la Séance
    </button>

    <div id="timer" style="font-size: 24px; font-weight: bold; color: #333; margin-top: 20px;"></div>

    <!-- 🔽 Bouton Terminer (masqué au départ) -->
    <div id="end-form" style="margin-top: 40px; display: none;">
        <form method="post" action="@Url.Action("CreateActivityMetadata", "Activite")">
            <input type="hidden" name="userId" value="@userId" />
            <input type="hidden" name="activityId" value="@activityId" />
            <button type="submit" style="padding: 12px 30px; background-color: #f44336; color: white; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer;">
                Terminer
            </button>
        </form>
    </div>
</div>

<script>
    let currentStep = 0;
    const steps = [
        { text: "Commencez par prendre des profonde inspiration et conservez celles-ci jusqu'à la fin de l'activité.", duration: 10 },
        { text: "Contractez les muscles de vos pieds. Maintenez la tension pendant 5 secondes, puis relâchez. Ressentez la détente qui suit.", duration: 10 },
        { text: "Passez à vos mollets. Contractez les muscles et maintenez la tension pendant 5 secondes, puis relâchez.", duration: 10 },
        { text: "Faites de même avec vos cuisses. Contractez, maintenez, puis relâchez.", duration: 10 },
        { text: "Contractez les muscles de votre ventre. Maintenez la tension pendant 5 secondes, puis relâchez.", duration: 10 },
        { text: "Maintenant, contractez vos bras. Maintenez la tension pendant 5 secondes, puis relâchez.", duration: 10 },
        { text: "Faites de même avec les muscles de votre visage : contractez vos muscles faciaux, maintenez pendant 5 secondes, puis relâchez.", duration: 10 },
        { text: "Prenez quelques instants pour ressentir l'effet de cette relaxation. Profitez de la sensation de calme.", duration: 20 }
    ];

    function startRelaxation() {
        document.getElementById("start-button").disabled = true;
        showStep();
    }

    function showStep() {
        if (currentStep < steps.length) {
            document.getElementById("step-text").innerText = steps[currentStep].text;
            startTimer(steps[currentStep].duration);
        } else {
            document.getElementById("step-text").innerText = "Félicitations, vous avez terminé la relaxation musculaire progressive.";
            document.getElementById("timer").innerText = "";
            document.getElementById("end-form").style.display = "block"; // 👈 Affiche le formulaire de validation
        }
    }

    function startTimer(duration) {
        let timeLeft = duration;
        document.getElementById("timer").innerText = timeLeft + "s";

        let timerInterval = setInterval(function () {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft + "s";

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                currentStep++;
                showStep();
            }
        }, 1000);
    }
</script>
